<script>
  const game = document.getElementById('game');
  const ringSize = document.getElementById('ringSize');
  const turnInfo = document.getElementById('turnInfo');

  let currentPlayer = 1;
  let gameOver = false;
  const boardState = Array.from({ length: 9 }, () => ({
    small: null,
    medium: null,
    large: null
  }));

  const winPatterns = [
    [0, 1, 2], [3, 4, 5], [6, 7, 8], // Rows
    [0, 3, 6], [1, 4, 7], [2, 5, 8], // Columns
    [0, 4, 8], [2, 4, 6]             // Diagonals
  ];

  function renderBoard() {
    game.innerHTML = '';
    boardState.forEach((cell, i) => {
      const div = document.createElement('div');
      div.className = 'cell';
      div.dataset.index = i;

      ['large', 'medium', 'small'].forEach(size => {
        if (cell[size]) {
          const ring = document.createElement('div');
          ring.className = `ring ${size} player${cell[size]}`;
          div.appendChild(ring);
        }
      });

      div.onclick = () => placeRing(i);
      game.appendChild(div);
    });
  }

  function placeRing(index) {
    if (gameOver) return;
    const size = ringSize.value;
    const cell = boardState[index];
    if (cell[size] !== null) return alert("That size already exists here!");

    cell[size] = currentPlayer;
    renderBoard();

    if (checkWin()) {
      gameOver = true;
      turnInfo.innerText = `ðŸŽ‰ Player ${currentPlayer} wins!`;
      return;
    }

    // Switch turn
    currentPlayer = currentPlayer === 1 ? 2 : 1;
    turnInfo.innerText = `Current Turn: Player ${currentPlayer} (${currentPlayer === 1 ? 'Red' : 'Blue'})`;
  }

  function checkWin() {
    // 1. Same-size in a line
    for (let size of ['small', 'medium', 'large']) {
      for (let pattern of winPatterns) {
        const [a, b, c] = pattern;
        if (
          boardState[a][size] === currentPlayer &&
          boardState[b][size] === currentPlayer &&
          boardState[c][size] === currentPlayer
        ) {
          return true;
        }
      }
    }

    // 2. Size sequence (s, m, l) in a line (all same player)
    for (let pattern of winPatterns) {
      const [a, b, c] = pattern;
      if (
        boardState[a].small === currentPlayer &&
        boardState[b].medium === currentPlayer &&
        boardState[c].large === currentPlayer
      ) {
        return true;
      }
      if (
        boardState[a].large === currentPlayer &&
        boardState[b].medium === currentPlayer &&
        boardState[c].small === currentPlayer
      ) {
        return true;
      }
    }

    // 3. Nested full set in one cell
    for (let i = 0; i < 9; i++) {
      const cell = boardState[i];
      if (
        cell.small === currentPlayer &&
        cell.medium === currentPlayer &&
        cell.large === currentPlayer
      ) {
        return true;
      }
    }

    return false;
  }

  function resetGame() {
    for (let cell of boardState) {
      cell.small = null;
      cell.medium = null;
      cell.large = null;
    }
    currentPlayer = 1;
    gameOver = false;
    renderBoard();
    turnInfo.innerText = 'Current Turn: Player 1 (Red)';
  }

  renderBoard();
</script>
